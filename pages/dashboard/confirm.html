<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- stylesheet -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kanit">
    <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="../../plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">
    <link rel="stylesheet" href="../../assets/css/adminlte.min.css">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <!-- Datatables -->
    <link rel="stylesheet" href="../../plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="../../plugins/datatables-responsive/css/responsive.bootstrap4.min.css">

    <style>
        .round-card:nth-child(1) {
            margin-bottom: 30px;
        }

        #successAlert {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 9999;
            display: none;
        }

        .edit-icon {
            position: absolute;
            top: 7px;
            right: 15px;
            cursor: pointer;
            font-size: 1.2rem;
            color: #ffffff;
        }

        .bg-danger {
            background-color: red !important;
        }

        .bg-primary {
            background-color: blue !important;
        }

        .modal-body .form-group label {
            font-weight: bold;
        }

        .modal-body input {
            background-color: rgba(255, 255, 255, 0.8);
        }

        /* ส่วนของ card-header ห้ามแก้ ลบ เพิ่ม */

        #matchContainer {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
            margin: 0;
            width: 100%;
            font-size: 2.5vw;
            /* ปรับขนาดฟอนต์ตามขนาดหน้าจอ */
        }

        .match-item span:nth-child(3) {
            font-size: 2.5rem;
            font-weight: 900;
            background: linear-gradient(to right, red 50%, blue 50%);
            background-clip: text;
            color: transparent;
        }

        .text-vs {
            margin: 0 10px 0 10px;
            font-size: 5rem;
            font-weight: 900;
            background: linear-gradient(to right, red 50%, blue 50%);
            background-clip: text;
            color: transparent;
        }
    </style>

</head>

<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        <div id="sidebar"></div>
        <div class="content-wrapper pt-3">
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow">
                                <div class="card-header shadow">
                                    <div class="d-flex justify-content-center align-items-center">

                                        <div class="dropdown">
                                            <h2>
                                                ยืนยันคะแนน
                                            </h2>
                                            <button class="btn btn-danger dropdown-toggle" type="button"
                                                id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                                เลือกยกที่
                                            </button>
                                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                <a class="dropdown-item" href="#" data-round="1">1</a>
                                                <a class="dropdown-item" href="#" data-round="2">2</a>
                                                <a class="dropdown-item" href="#" data-round="3">3</a>
                                                <a class="dropdown-item" href="#" data-round="4">4</a>
                                                <a class="dropdown-item" href="#" data-round="5">5</a>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <p class="text-center match-item" id="matchContainer">
                                                <!-- Remove the hardcoded example -->
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <!-- ยกที่1 -->
                                        <div class="col-md-4">
                                            <div class="round-card p-3 round1"
                                                style=" background: linear-gradient(to right, red 50%, blue 50%); border-radius: 10px;">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#editModal">
                                                    <div class="edit-icon">
                                                        <i class="fa-regular fa-pen-to-square fa-xl"></i>
                                                    </div>
                                                </a>
                                                <h1 class="round text-center text-white">ยกที่ 1</h1>
                                                <div class="row">
                                                    <div class="red-side col-6 ">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 2</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 3</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 2</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 3</label>
                                                        <input type="number" placeholder="รอคะ��นน"
                                                            class="form-control mb-2" disabled>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-3">
                                                    <button class="btn btn-warning btn-save"
                                                        style="width: 120px;">บันทึก</button>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="col-md-4">
                                            <div class="round-card p-3 round2"
                                                style=" background: linear-gradient(to right, red 50%, blue 50%); border-radius: 10px;">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#editModal">
                                                    <div class="edit-icon">
                                                        <i class="fa-regular fa-pen-to-square fa-xl"></i>
                                                    </div>
                                                </a>
                                                <h1 class="round text-center text-white">ยกที่ 2</h1>
                                                <div class="row">
                                                    <div class="red-side col-6 ">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 2</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 3</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 2</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 3</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-3">
                                                    <button class="btn btn-warning btn-save"
                                                        style="width: 120px;">บันทึก</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="round-card p-3 round3"
                                                style=" background: linear-gradient(to right, red 50%, blue 50%); border-radius: 10px;">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#editModal">
                                                    <div class="edit-icon">
                                                        <i class="fa-regular fa-pen-to-square fa-xl"></i>
                                                    </div>
                                                </a>
                                                <h1 class="round text-center text-white">ยกที่ 3</h1>
                                                <div class="row">
                                                    <div class="red-side col-6 ">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 2</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 3</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 2</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 3</label>
                                                        <input type="number" placeholder="รอค��แนน"
                                                            class="form-control mb-2" disabled>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-3">
                                                    <button class="btn btn-warning btn-save"
                                                        style="width: 120px;">บันทึก</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="round-card p-3 round4"
                                                style=" background: linear-gradient(to right, red 50%, blue 50%); border-radius: 10px;">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#editModal">
                                                    <div class="edit-icon">
                                                        <i class="fa-regular fa-pen-to-square fa-xl"></i>
                                                    </div>
                                                </a>
                                                <h1 class="round text-center text-white">ยกที่ 4</h1>
                                                <div class="row">
                                                    <div class="red-side col-6 ">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 2</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 3</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 2</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 3</label>
                                                        <input type="number" placeholder="รอคะ��นน"
                                                            class="form-control mb-2" disabled>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-3">
                                                    <button class="btn btn-warning btn-save"
                                                        style="width: 120px;">บันทึก</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="round-card p-3 round5"
                                                style=" background: linear-gradient(to right, red 50%, blue 50%); border-radius: 10px;">
                                                <a href="#" data-bs-toggle="modal" data-bs-target="#editModal">
                                                    <div class="edit-icon">
                                                        <i class="fa-regular fa-pen-to-square fa-xl"></i>
                                                    </div>
                                                </a>
                                                <h1 class="round text-center text-white">ยกที่ 5</h1>
                                                <div class="row">
                                                    <div class="red-side col-6 ">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 2</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 3</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 2</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 3</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-2" disabled>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-3">
                                                    <button class="btn btn-warning btn-save"
                                                        style="width: 120px;">บันทึก</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="round-card p-3"
                                                style=" background: linear-gradient(to right, red 50%, blue 50%); border-radius: 10px;">
                                                <a href="">
                                                </a>
                                                <h1 class="round text-center text-white">สรุปคะแนน</h1>
                                                <div class="row">
                                                    <div class="red-side col-6 ">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-4" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 4</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-4" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 4</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-4" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" lable="judge">JUDGE 1</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-4" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 4</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-4" disabled>
                                                        <label class="text-white" lable="judge">JUDGE 4</label>
                                                        <input type="number" placeholder="รอคะแนน"
                                                            class="form-control mb-4" disabled>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="footer"></div>
    </div>

    <!-- Modal for Editing Scores -->
    <div class="modal fade" id="editScoreModal" tabindex="-1" role="dialog" aria-labelledby="editScoreModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editScoreModalLabel">แก้ไขคะแนน</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editScoreForm">
                        <div class="row">
                            <!-- ฝั่งซ้าย (Red) -->
                            <div class="col-md-6 bg-danger text-white p-3">
                                <h5 class="text-white">ฝั่งแดง (Red)</h5>
                                <div class="form-group">
                                    <label for="redScore1">Judge 1</label>
                                    <input type="number" class="form-control" id="redScore1" required>
                                </div>
                                <div class="form-group">
                                    <label for="redScore2">Judge 2</label>
                                    <input type="number" class="form-control" id="redScore2" required>
                                </div>
                                <div class="form-group">
                                    <label for="redScore3">Judge 3</label>
                                    <input type="number" class="form-control" id="redScore3" required>
                                </div>
                            </div>

                            <!-- ฝั่งขวา (Blue) -->
                            <div class="col-md-6 bg-primary text-white p-3">
                                <h5 class="text-white">ฝั่งน้ำเงิน (Blue)</h5>
                                <div class="form-group">
                                    <label for="blueScore1">Judge 1</label>
                                    <input type="number" class="form-control" id="blueScore1" required>
                                </div>
                                <div class="form-group">
                                    <label for="blueScore2">Judge 2</label>
                                    <input type="number" class="form-control" id="blueScore2" required>
                                </div>
                                <div class="form-group">
                                    <label for="blueScore3">Judge 3</label>
                                    <input type="number" class="form-control" id="blueScore3" required>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <!-- ปุ่มยกเลิก -->
                    <button type="button" class="btn btn-primary" id="saveEdit">บันทึก</button>

                    <!-- ปุ่มบันทึก -->
                    <button type="button" class="btn btn-secondary" id="cancelEdit">ยกเลิก</button>
                </div>
            </div>
        </div>
    </div>


    <script src="../../plugins/jquery/jquery.min.js"></script>
    <script src="../../plugins/fontawesome-free/js/all.min.js"></script>
    <script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../../plugins/sweetalert2/sweetalert2.min.js"></script>
    <script src="../../assets/js/adminlte.min.js"></script>

    <script src="../../plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="../../plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="../../plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="../../plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>

    <script>

        fetch('../includes/sidebar.html')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then(data => {
                document.getElementById('sidebar').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading sidebar:', error);
            });

        fetch('../includes/footer.html')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then(data => {
                document.getElementById('footer').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading footer:', error);
            });
    </script>

    <script>
        $(document).ready(function () {
            // เพิ่ม event listener ให้กับปุ่มที่มี class .btn-save
            $('.btn-save').on('click', function () {
                // จำลองการบันทึกข้อมูล
                saveData()
                    .then(() => {
                        // แสดง SweetAlert เมื่อบันทึกสำเร็จ
                        Swal.fire({
                            icon: 'success',
                            title: 'บันทึกสำเร็จ',
                            text: 'ข้อมูลของคุณถูกบันทึกเรียบร้อยแล้ว',
                            confirmButtonText: 'ตกลง'
                        });
                    })
                    .catch((error) => {
                        // แสดง SweetAlert เมื่อเกิดข้อผิดพลาด
                        Swal.fire({
                            icon: 'error',
                            title: 'เกิดข้อผิดพลาด',
                            text: 'ไม่สามารถบันทึกข้อมูลได้: ' + error,
                            confirmButtonText: 'ตกลง'
                        });
                    });
            });

            function saveData() {
                return new Promise((resolve, reject) => {

                    setTimeout(() => {

                        resolve();
                    }, 50);
                });
            }
        });

        $(document).ready(function () {
            let currentCard; // การ์ดปัจจุันที่แก้ไข
            let originalValues = {}; // เก็บค่าดั้งเดิมของการ์ด

            // เมื่อคลิกปุ่ม Edit
            $('.edit-icon').on('click', function () {
                currentCard = $(this).closest('.round-card');

                // เก็บค่าปัจจุบันใน originalValues
                const redScores = currentCard.find('.red-side input');
                const blueScores = currentCard.find('.blue-side input');

                originalValues = {
                    red: [
                        $(redScores[0]).val(),
                        $(redScores[1]).val(),
                        $(redScores[2]).val()
                    ],
                    blue: [
                        $(blueScores[0]).val(),
                        $(blueScores[1]).val(),
                        $(blueScores[2]).val()
                    ]
                };

                // เติมค่าดั้งเดิมลงใน Modal
                $('#redScore1').val(originalValues.red[0]);
                $('#redScore2').val(originalValues.red[1]);
                $('#redScore3').val(originalValues.red[2]);
                $('#blueScore1').val(originalValues.blue[0]);
                $('#blueScore2').val(originalValues.blue[1]);
                $('#blueScore3').val(originalValues.blue[2]);

                // แสดง Modal
                $('#editScoreModal').modal('show');
            });

            // เมื่อกดปุ่ม "บันทึก"
            $('#saveEdit').on('click', function () {
                const redScores = currentCard.find('.red-side input');
                const blueScores = currentCard.find('.blue-side input');

                // อัปเดตค่าจาก Modal ลงการ์ด
                $(redScores[0]).val($('#redScore1').val());
                $(redScores[1]).val($('#redScore2').val());
                $(redScores[2]).val($('#redScore3').val());
                $(blueScores[0]).val($('#blueScore1').val());
                $(blueScores[1]).val($('#blueScore2').val());
                $(blueScores[2]).val($('#blueScore3').val());

                // ปิด Modal
                $('#editScoreModal').modal('hide');

                // แสดงข้อความสำเร็จ
                Swal.fire({
                    icon: 'success',
                    title: 'แก้ไขสำเร็จ',
                    text: 'คะแนนถูกแก้ไขเรียบร้อยแล้ว',
                    confirmButtonText: 'ตกลง'
                });
            });

            // เมื่อกดปุ่ม "ยกเลิก"
            $('#cancelEdit').on('click', function () {
                // ปิด Modal
                $('#editScoreModal').modal('hide');


                Swal.fire({
                    icon: 'info',
                    title: 'ยกเลิกการแก้ไข',
                    text: 'คะแนนยังคงเหมือนเดิม',
                    confirmButtonText: 'ตกลง'
                });
            });
        });

        $('.btn-save').on('click', function () {
            calculateTotalScores();
        });
    </script>

    <script>
    function loadActiveMatch() {
        $.ajax({
            url: 'get_active_match.php',
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                console.log('Response:', response); // Debug log
                if (response && response.status === 'success' && response.data) {
                    const match = response.data;
                    const matchHtml = `
                        <span class="match-item">
                            ${match.person_red} <span class="text-vs">VS</span> ${match.person_blue}
                        </span>
                    `;
                    $('#matchContainer').html(matchHtml);
                } else {
                    $('#matchContainer').html('<span class="text-muted">ไม่มีคู่มวยที่กำลังแข่งขัน</span>');
                }
            },
            error: function(xhr, status, error) {
                console.error('Ajax Error:', error);
                console.error('Response Text:', xhr.responseText);
                $('#matchContainer').html('<span class="text-danger">เกิดข้อผิดพลาดในการโหลดข้อมูล</span>');
            }
        });
    }

    $(document).ready(function() {
        // โหลดข้อมูลคู่มวยเมื่อโหลดหน้าเว็บ
        loadActiveMatch();
        
        // รีเฟรชข้อมูลทุก 10 วินาที
        setInterval(loadActiveMatch, 10000);
    });
    </script>
</body>

</html>