<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon.ico">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- stylesheet -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Kanit">
    <link rel="stylesheet" href="../../plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="../../plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">
    <link rel="stylesheet" href="../../assets/css/adminlte.min.css">
    <link rel="stylesheet" href="../../assets/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <!-- Datatables -->
    <link rel="stylesheet" href="../../plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="../../plugins/datatables-responsive/css/responsive.bootstrap4.min.css">

    <style>
        /* ปรับพื้นหลังและระยะห่างให้ตรงกับยกที่ 1-5 */
        .round-card {
            background: linear-gradient(to right, red 50%, blue 50%);
            border-radius: 10px;
            margin-bottom: 20px;
            /* ระยะห่างระหว่างรอบ */
            padding: 15px;
            /* เพิ่มการ padding เพื่อให้พื้นที่ดูสมดุล */
            position: relative;
        }

        .round {
            background-color: transparent;
        }

        .card-body {
            padding-top: 1;
            /* ลบ padding บน */
        }

        .col-md-4 {
            margin-bottom: 20px;
            /* เพิ่มระยะห่างระหว่างคอลัมน์ */
        }

        /* เพิ่มการกำหนดความสูงของแต่ละรอบ */
        .round-card .round {
            height: 100%;
        }

        /* ปรับขนาดของปุ่มให้เหมาะสม */
        .btn-save {
            width: 120px;
        }

        /* ส่วนของ card-header ห้ามแก้ ลบ เพิ่ม */

        #matchContainer {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100px;
            margin: 0;
            width: 100%;
            font-size: 2.5vw;
            /* ปรับขนาดฟอนต์ตามขนาดหน้าจอ */
        }

        .match-item span {
            font-size: 4rem;
            font-weight: 900;
        }

        .text-vs {
            margin: 0 10px 0 10px;
            font-size: 5rem;
            font-weight: 900;
            background: linear-gradient(to right, red 50%, blue 50%);
            background-clip: text;
            color: transparent;
        }

        .edit-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .btn-save.btn-secondary {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-save.btn-warning {
            opacity: 1;
            cursor: pointer;
        }
    </style>

</head>

<body class="hold-transition sidebar-mini">
    <div class="wrapper">
        <div id="sidebar"></div>
        <div class="content-wrapper pt-3">
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-12">
                            <div class="card shadow">
                                <div class="card-header shadow">
                                    <div class="d-flex justify-content-center align-items-center">

                                        <div class="dropdown">
                                            <h2>ยืนยันคะแนน</h2>
                                            <button class="btn btn-danger dropdown-toggle" type="button"
                                                id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true"
                                                aria-expanded="false">
                                                เลือกยกที่
                                            </button>
                                            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                <a class="dropdown-item" href="#" onclick="updateRound(1); return false;">1</a>
                                                <a class="dropdown-item" href="#" onclick="updateRound(2); return false;">2</a>
                                                <a class="dropdown-item" href="#" onclick="updateRound(3); return false;">3</a>
                                                <a class="dropdown-item" href="#" onclick="updateRound(4); return false;">4</a>
                                                <a class="dropdown-item" href="#" onclick="updateRound(5); return false;">5</a>
                                            </div>
                                        </div>
                                        <div class="flex-grow-1">
                                            <p class="text-center match-item" id="matchContainer">
                                                <!-- Data will be populated dynamically -->
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <!-- ยกที่ 1 -->
                                        <div class="col-md-4">
                                            <div class="round-card p-3">
                                                <button class="edit-button">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <h1 class="round text-center text-white">ยกที่ 1</h1>
                                                <div class="row">
                                                    <div class="red-side col-6">
                                                        <label class="text-white" for="R1_JR1">JUDGE 1</label>
                                                        <input type="number" class="form-control mb-2" id="R1_JR1" name="R1_JR1" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R1_JR2">JUDGE 2</label>
                                                        <input type="number" class="form-control mb-2" id="R1_JR2" name="R1_JR2" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R1_JR3">JUDGE 3</label>
                                                        <input type="number" class="form-control mb-2" id="R1_JR3" name="R1_JR3" placeholder="กรอกคะแนน" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" for="R1_JB1">JUDGE 1</label>
                                                        <input type="number" class="form-control mb-2" id="R1_JB1" name="R1_JB1" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R1_JB2">JUDGE 2</label>
                                                        <input type="number" class="form-control mb-2" id="R1_JB2" name="R1_JB2" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R1_JB3">JUDGE 3</label>
                                                        <input type="number" class="form-control mb-2" id="R1_JB3" name="R1_JB3" placeholder="กรอกคะแนน" disabled>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-3">
                                                    <button class="btn btn-warning btn-save">บันทึก</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ยกที่ 2 -->
                                        <div class="col-md-4">
                                            <div class="round-card p-3">
                                                <button class="edit-button">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <h1 class="round text-center text-white">ยกที่ 2</h1>
                                                <div class="row">
                                                    <div class="red-side col-6">
                                                        <label class="text-white" for="R2_JR1">JUDGE 1</label>
                                                        <input type="number" class="form-control mb-2" id="R2_JR1" name="R2_JR1" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R2_JR2">JUDGE 2</label>
                                                        <input type="number" class="form-control mb-2" id="R2_JR2" name="R2_JR2" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R2_JR3">JUDGE 3</label>
                                                        <input type="number" class="form-control mb-2" id="R2_JR3" name="R2_JR3" placeholder="กรอกคะแนน" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" for="R2_JB1">JUDGE 1</label>
                                                        <input type="number" class="form-control mb-2" id="R2_JB1" name="R2_JB1" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R2_JB2">JUDGE 2</label>
                                                        <input type="number" class="form-control mb-2" id="R2_JB2" name="R2_JB2" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R2_JB3">JUDGE 3</label>
                                                        <input type="number" class="form-control mb-2" id="R2_JB3" name="R2_JB3" placeholder="กรอกคะแนน" disabled>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-3">
                                                    <button class="btn btn-warning btn-save">บันทึก</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ยกที่ 3 -->
                                        <div class="col-md-4">
                                            <div class="round-card p-3">
                                                <button class="edit-button">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <h1 class="round text-center text-white">ยกที่ 3</h1>
                                                <div class="row">
                                                    <div class="red-side col-6">
                                                        <label class="text-white" for="R3_JR1">JUDGE 1</label>
                                                        <input type="number" class="form-control mb-2" id="R3_JR1" name="R3_JR1" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R3_JR2">JUDGE 2</label>
                                                        <input type="number" class="form-control mb-2" id="R3_JR2" name="R3_JR2" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R3_JR3">JUDGE 3</label>
                                                        <input type="number" class="form-control mb-2" id="R3_JR3" name="R3_JR3" placeholder="กรอกคะแนน" disabled >
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" for="R3_JB1">JUDGE 1</label>
                                                        <input type="number" class="form-control mb-2" id="R3_JB1" name="R3_JB1" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R3_JB2">JUDGE 2</label>
                                                        <input type="number" class="form-control mb-2" id="R3_JB2" name="R3_JB2" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R3_JB3">JUDGE 3</label>
                                                        <input type="number" class="form-control mb-2" id="R3_JB3" name="R3_JB3" placeholder="กรอกคะแนน" disabled>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-3">
                                                    <button class="btn btn-warning btn-save">บันทึก</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <!-- ยกที่ 4 -->
                                        <div class="col-md-4">
                                            <div class="round-card p-3">
                                                <button class="edit-button">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <h1 class="round text-center text-white">ยกที่ 4</h1>
                                                <div class="row">
                                                    <div class="red-side col-6">
                                                        <label class="text-white" for="R4_JR1">JUDGE 1</label>
                                                        <input type="number" class="form-control mb-2" id="R4_JR1" name="R4_JR1" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R4_JR2">JUDGE 2</label>
                                                        <input type="number" class="form-control mb-2" id="R4_JR2" name="R4_JR2" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R4_JR3">JUDGE 3</label>
                                                        <input type="number" class="form-control mb-2" id="R4_JR3" name="R4_JR3" placeholder="กรอกคะแนน" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" for="R4_JB1">JUDGE 1</label>
                                                        <input type="number" class="form-control mb-2" id="R4_JB1" name="R4_JB1" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R4_JB2">JUDGE 2</label>
                                                        <input type="number" class="form-control mb-2" id="R4_JB2" name="R4_JB2" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R4_JB3">JUDGE 3</label>
                                                        <input type="number" class="form-control mb-2" id="R4_JB3" name="R4_JB3" placeholder="กรอกคะแนน" disabled>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-3">
                                                    <button class="btn btn-warning btn-save">บันทึก</button>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- ยกที่ 5 -->
                                        <div class="col-md-4">
                                            <div class="round-card p-3">
                                                <button class="edit-button">
                                                    <i class="fas fa-edit"></i>
                                                </button>
                                                <h1 class="round text-center text-white">ยกที่ 5</h1>
                                                <div class="row">
                                                    <div class="red-side col-6">
                                                        <label class="text-white" for="R5_JR1">JUDGE 1</label>
                                                        <input type="number" class="form-control mb-2" id="R5_JR1" name="R5_JR1" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R5_JR2">JUDGE 2</label>
                                                        <input type="number" class="form-control mb-2" id="R5_JR2" name="R5_JR2" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R5_JR3">JUDGE 3</label>
                                                        <input type="number" class="form-control mb-2" id="R5_JR3" name="R5_JR3" placeholder="กรอกคะแนน" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" for="R5_JB1">JUDGE 1</label>
                                                        <input type="number" class="form-control mb-2" id="R5_JB1" name="R5_JB1" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R5_JB2">JUDGE 2</label>
                                                        <input type="number" class="form-control mb-2" id="R5_JB2" name="R5_JB2" placeholder="กรอกคะแนน" disabled>
                                                        <label class="text-white" for="R5_JB3">JUDGE 3</label>
                                                        <input type="number" class="form-control mb-2" id="R5_JB3" name="R5_JB3" placeholder="กรอกคะแนน" disabled>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-center mt-3">
                                                    <button class="btn btn-warning btn-save">บันทึก</button>
                                                </div>
                                            </div>
                                        </div>

                                        
                                        <!-- สรุปคะแนน -->
                                        <div class="col-md-4">
                                            <div class="round-card p-3">
                                                <h1 class="round text-center text-white" style="font-size: 2.7rem;">
                                                    สรุปคะแนน</h1>
                                                <div class="row">
                                                    <div class="red-side col-6">
                                                        <label class="text-white" for="Score_JR1">SUM JUDGE 1</label>
                                                        <input type="number" class="form-control mb-4" id="Score_JR1" name="Score_JR1"
                                                            placeholder="สรุปคะแนน" disabled>
                                                        <label class="text-white" for="Score_JR2">SUM JUDGE 2</label>
                                                        <input type="number" class="form-control mb-4" id="Score_JR2" name="Score_JR2"
                                                            placeholder="สรุปคะแนน" disabled>
                                                        <label class="text-white" for="Score_JR3">SUM JUDGE 3</label>
                                                        <input type="number" class="form-control mb-4" id="Score_JR3" name="Score_JR3"
                                                            placeholder="สรุปคะแนน" disabled>
                                                    </div>
                                                    <div class="blue-side col-6">
                                                        <label class="text-white" for="Score_JB1">SUM JUDGE 1</label>
                                                        <input type="number" class="form-control mb-4" id="Score_JB1" name="Score_JB1"
                                                            placeholder="สรุปคะแนน" disabled>
                                                        <label class="text-white" for="Score_JB2">SUM JUDGE 2</label>
                                                        <input type="number" class="form-control mb-4" id="Score_JB2" name="Score_JB2"
                                                            placeholder="สรุปคะแนน" disabled>
                                                        <label class="text-white" for="Score_JB3">SUM JUDGE 3</label>
                                                        <input type="number" class="form-control mb-4" id="Score_JB3" name="Score_JB3"
                                                            placeholder="สรุปคะแนน" disabled>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="footer"></div>
    </div>

    <!-- Modal for Editing Scores -->
    <div class="modal fade" id="editScoreModal" tabindex="-1" role="dialog" aria-labelledby="editScoreModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editScoreModalLabel">แก้ไขคะแนน</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editScoreForm">
                        <div class="row">
                            <!-- ฝั่งซ้าย (Red) -->
                            <div class="col-md-6 bg-danger text-white p-3">
                                <h5 class="text-white">ฝั่งแดง (Red)</h5>
                                <div class="form-group">
                                    <label for="redScore1">Judge 1</label>
                                    <input type="number" class="form-control" id="redScore1" required>
                                </div>
                                <div class="form-group">
                                    <label for="redScore2">Judge 2</label>
                                    <input type="number" class="form-control" id="redScore2" required>
                                </div>
                                <div class="form-group">
                                    <label for="redScore3">Judge 3</label>
                                    <input type="number" class="form-control" id="redScore3" required>
                                </div>
                            </div>

                            <!-- ฝั่งขวา (Blue) -->
                            <div class="col-md-6 bg-primary text-white p-3">
                                <h5 class="text-white">ฝั่งน้ำเงิน (Blue)</h5>
                                <div class="form-group">
                                    <label for="blueScore1">Judge 1</label>
                                    <input type="number" class="form-control" id="blueScore1" required>
                                </div>
                                <div class="form-group">
                                    <label for="blueScore2">Judge 2</label>
                                    <input type="number" class="form-control" id="blueScore2" required>
                                </div>
                                <div class="form-group">
                                    <label for="blueScore3">Judge 3</label>
                                    <input type="number" class="form-control" id="blueScore3" required>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <!-- ปุ่มยกเลิก -->
                    <button type="button" class="btn btn-primary" id="saveEdit">บันทึก</button>

                    <!-- ปุ่มบันทึก -->
                    <button type="button" class="btn btn-secondary" id="cancelEdit">ยกเลิก</button>
                </div>
            </div>
        </div>
    </div>


    <script src="../../plugins/jquery/jquery.min.js"></script>
    <script src="../../plugins/fontawesome-free/js/all.min.js"></script>
    <script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../../plugins/sweetalert2/sweetalert2.min.js"></script>
    <script src="../../assets/js/adminlte.min.js"></script>

    <script src="../../plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="../../plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="../../plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="../../plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>

    <script>

        fetch('../includes/sidebar.html')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then(data => {
                document.getElementById('sidebar').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading sidebar:', error);
            });

        fetch('../includes/footer.html')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then(data => {
                document.getElementById('footer').innerHTML = data;
            })
            .catch(error => {
                console.error('Error loading footer:', error);
            });

        // Function to fetch and display active match
        function fetchActiveMatch() {
            fetch('../../service/confirm.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const matchContainer = document.getElementById('matchContainer');
                        matchContainer.innerHTML = `
                            <span class="text-danger">${data.redName}</span>
                            <span class="text-vs">VS</span>
                            <span class="text-primary">${data.blueName}</span>
                        `;
                    } else {
                        console.error('No active match found');
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        // Call the function when page loads
        document.addEventListener('DOMContentLoaded', fetchActiveMatch);

        function updateRound(roundNumber) {
            fetch('../../service/update_round.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    round: roundNumber
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // อัพเดทข้อความบนปุ่ม dropdown
                    document.getElementById('dropdownMenuButton').textContent = 'ยกที่ ' + roundNumber;
                    
                    // ปิดปุ่มบันทึกทั้งหมดก่อน
                    document.querySelectorAll('.btn-save').forEach(button => {
                        button.disabled = true;
                        button.classList.remove('btn-warning');
                        button.classList.add('btn-secondary');
                    });
                    
                    // เปิดปุ่มบันทึกของยกที่เลือก
                    const selectedRoundButton = document.querySelectorAll('.btn-save')[roundNumber - 1];
                    if (selectedRoundButton) {
                        selectedRoundButton.disabled = false;
                        selectedRoundButton.classList.remove('btn-secondary');
                        selectedRoundButton.classList.add('btn-warning');
                    }
                    
                    Swal.fire({
                        icon: 'success',
                        title: 'อัพเดทยกที่ ' + roundNumber + ' สำเร็จ',
                        showConfirmButton: false,
                        timer: 1500
                    });
                } else {
                    Swal.fire({
                        icon: 'error',
                        title: 'เกิดข้อผิดพลาด',
                        text: data.message
                    });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                Swal.fire({
                    icon: 'error',
                    title: 'เกิดข้อผิดพลาด',
                    text: 'ไม่สามารถอัพเดทยกได้'
                });
            });
        }

        let isEditing = false; // เพิ่มตัวแปรเพื่อติดตามสถานะการแก้ไข

        function fetchAndDisplayScores() {
            // ถ้ากำลังแก้ไขอยู่ ไม่ต้องอัพเดทค่า
            if (isEditing) return;

            fetch('../../service/scores.php')
                .then(response => response.json())
                .then(result => {
                    if (result.success && result.data) {
                        const scores = result.data;
                        
                        // Helper function to set input values
                        const setValue = (id, value) => {
                            const element = document.getElementById(id);
                            if (element) {
                                element.value = value !== null && value !== undefined ? value : '';
                            }
                        };

                        // Set values for each round
                        ['1', '2', '3', '4', '5'].forEach(round => {
                            ['R', 'B'].forEach(color => {
                                [1, 2, 3].forEach(judge => {
                                    const fieldId = `R${round}_J${color}${judge}`;
                                    setValue(fieldId, scores[fieldId]);
                                });
                            });
                        });

                        // Set total scores
                        ['R', 'B'].forEach(color => {
                            [1, 2, 3].forEach(judge => {
                                const fieldId = `Score_J${color}${judge}`;
                                setValue(fieldId, scores[fieldId]);
                            });
                        });
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        // Call when page loads and every 5 seconds
        document.addEventListener('DOMContentLoaded', () => {
            fetchAndDisplayScores();
            setInterval(fetchAndDisplayScores, 5000);
            
            const editScoreModal = new bootstrap.Modal(document.getElementById('editScoreModal'));
            let currentRound = null;
            let currentSaveButton = null; // Store reference to current round's save button
            
            // Add event listeners for edit buttons
            const editButtons = document.querySelectorAll('.edit-button');
            
            editButtons.forEach((button, index) => {
                button.addEventListener('click', () => {
                    isEditing = true; // เริ่มการแก้ไข
                    currentRound = index + 1;
                    const round = `R${currentRound}`;
                    currentSaveButton = button.closest('.round-card').querySelector('.btn-save');
                    
                    // Populate modal with current values
                    document.getElementById('redScore1').value = document.getElementById(`${round}_JR1`).value;
                    document.getElementById('redScore2').value = document.getElementById(`${round}_JR2`).value;
                    document.getElementById('redScore3').value = document.getElementById(`${round}_JR3`).value;
                    document.getElementById('blueScore1').value = document.getElementById(`${round}_JB1`).value;
                    document.getElementById('blueScore2').value = document.getElementById(`${round}_JB2`).value;
                    document.getElementById('blueScore3').value = document.getElementById(`${round}_JB3`).value;
                    
                    // Add input event listeners to update main form fields in real-time
                    ['red', 'blue'].forEach(color => {
                        [1, 2, 3].forEach(judge => {
                            const modalInput = document.getElementById(`${color}Score${judge}`);
                            modalInput.addEventListener('input', () => {
                                const mainField = document.getElementById(
                                    `${round}_J${color.charAt(0).toUpperCase()}${judge}`
                                );
                                mainField.value = modalInput.value;
                            });
                        });
                    });
                    
                    editScoreModal.show();
                });
            });
            
            // Handle save button click in modal
            document.getElementById('saveEdit').addEventListener('click', () => {
                const scoreData = {
                    round: currentRound,
                    scores: {
                        [`R${currentRound}_JR1`]: document.getElementById('redScore1').value,
                        [`R${currentRound}_JR2`]: document.getElementById('redScore2').value,
                        [`R${currentRound}_JR3`]: document.getElementById('redScore3').value,
                        [`R${currentRound}_JB1`]: document.getElementById('blueScore1').value,
                        [`R${currentRound}_JB2`]: document.getElementById('blueScore2').value,
                        [`R${currentRound}_JB3`]: document.getElementById('blueScore3').value
                    }
                };
                
                editScoreModal.hide();
                // ยังคงสถานะ editing จนกว่าจะกดบันทึกในฟอร์มหลัก
            });
            
            // Handle main form save buttons
            document.querySelectorAll('.btn-save').forEach((button, index) => {
                button.addEventListener('click', function() {
                    const round = index + 1;
                    const scoreData = {
                        round: round,
                        scores: {
                            [`R${round}_JR1`]: document.getElementById(`R${round}_JR1`).value,
                            [`R${round}_JR2`]: document.getElementById(`R${round}_JR2`).value,
                            [`R${round}_JR3`]: document.getElementById(`R${round}_JR3`).value,
                            [`R${round}_JB1`]: document.getElementById(`R${round}_JB1`).value,
                            [`R${round}_JB2`]: document.getElementById(`R${round}_JB2`).value,
                            [`R${round}_JB3`]: document.getElementById(`R${round}_JB3`).value
                        }
                    };
                    
                    fetch('../../service/update_scores.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(scoreData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            isEditing = false; // จบการแก้ไข
                            Swal.fire({
                                icon: 'success',
                                title: 'บันทึกคะแนนสำเร็จ',
                                showConfirmButton: false,
                                timer: 1500
                            });
                            fetchAndDisplayScores();
                        } else {
                            Swal.fire({
                                icon: 'error',
                                title: 'เกิดข้อผิดพลาด',
                                text: data.message
                            });
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        Swal.fire({
                            icon: 'error',
                            title: 'เกิดข้อผิดพลาด',
                            text: 'ไม่สามารถบันทึกคะแนนได้'
                        });
                    });
                });
            });
            
            // Handle cancel button click
            document.getElementById('cancelEdit').addEventListener('click', () => {
                isEditing = false; // ยกเลิกการแก้ไข
                editScoreModal.hide();
                fetchAndDisplayScores(); // โหลดข้อมูลใหม่
            });

            // เพิ่มการปิดปุ่มบันทึกทั้งหมดตอนโหลดหน้า
            document.querySelectorAll('.btn-save').forEach(button => {
                button.disabled = true;
                button.classList.remove('btn-warning');
                button.classList.add('btn-secondary');
            });

            // เพิ่มการเช็คยกปัจจุบันและเปิดปุ่มบันทึกที่เกี่ยวข้อง
            fetch('../../service/get_current_round.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success && data.round) {
                        const currentRound = data.round;
                        document.getElementById('dropdownMenuButton').textContent = 'ยกที่ ' + currentRound;
                        
                        const currentRoundButton = document.querySelectorAll('.btn-save')[currentRound - 1];
                        if (currentRoundButton) {
                            currentRoundButton.disabled = false;
                            currentRoundButton.classList.remove('btn-secondary');
                            currentRoundButton.classList.add('btn-warning');
                        }
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    </script>

</body>

</html>